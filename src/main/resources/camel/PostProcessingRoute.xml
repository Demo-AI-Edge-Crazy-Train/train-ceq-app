<routes xmlns="http://camel.apache.org/schema/spring">

    
    <route id="amqp-route">
    
        <!-- For demo purpose
        <from uri="timer:mytimer?repeatCount=5&amp;delay=3000"/>
        <setBody><constant>This is a Quarkus AMQP message</constant></setBody>
        <log message="Create AMQP message: ${body}"/>
        <toD uri="amqp:{{app.destinationaddress}}"/>
        -->


        <!-- replace this part -->
       <!-- <from uri="paho:{{train.mqtt.source.topicName}}?brokerUrl={{train.mqtt.brokerUrl}}"/> -->    
        <from uri="paho:{{train.mqtt.source.topicName}}?brokerUrl={{train.mqtt.brokerUrl}}"/>     
        <!--log message="MQTT message received:"/-->
        <!--log message="${body}"/-->
        <setHeader name="origin"><simple>${body}</simple></setHeader>
        <setHeader name="id"><jsonpath>$.id</jsonpath></setHeader>
        <log message="${header.id}"/>
        <unmarshal> <json library="Jackson" unmarshalType="org.redhat.demo.crazytrain.model.Result"/></unmarshal>
        <log message="unmarshalling done"/>
        <process ref="CommandProcessor"/>
        <log message="Command: ${body}"/>
        <toD uri="paho:{{command.mqtt.destination.topicName}}?brokerUrl={{train.mqtt.brokerUrl}}"/>
        <setBody><simple>${header.origin}</simple></setBody>
        <convertBodyTo type="java.lang.String"/>
        <!--log message="generating cloud event ${body}"/-->
        <process ref="CloudEventProcessor"/>
        <!--log message="${body}"/-->
        <toD uri="kafka:{{monitoring.kafka.destination.topicName}}?brokers={{train.kafka.brokerUrl}}"/>
        <log message="written into kafka"/>

    </route>


</routes>
